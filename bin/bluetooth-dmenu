#!/bin/sh
set -e

connected_device=$(bluetoothctl info | grep Name | cut -d: -f2- | xargs)
devices=$(bluetoothctl devices | cut -d' ' -f3-)
if [ -n "$connected_device" ]; then
  devices=$(
    sed 's/'"$connected_device"'/'"**$connected_device**"'/g'\ <<< $devices
  )
fi

target=$(dmenu -i -p "Devices:" <<< $devices)
echo $target

case $target in
  "")
    exit
    ;;
  "**$connected_device**")
    target="$connected_device"
    action="disconnect"
    ;;
  *)
    action="connect"
    ;;
esac

mac_address=$(
  bluetoothctl devices\
  | grep "$target"\
  | cut -d' ' -f2
)

notify-send -t 1000 "Bluteooth" "Attempting to $action with $target"
bluetoothctl "$action" "$mac_address"

if [ $? == 0 ]; then
  notify-send "Bluteooth" "Successfully ${action}ed with $target"
else
  notify-send "Bluteooth" "Failted to ${action} with $target"
fi
