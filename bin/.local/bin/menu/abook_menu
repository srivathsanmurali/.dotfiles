#!/bin/sh
## require abook

rofi_cmd='rofi -dmenu -i -matching fuzzy'

selected_name=$(
  cat ~/.abook/addressbook \
  | grep "name=" \
  | sed "s/name=//g" \
  | $rofi_cmd
)

[ -z "$selected_name" ] && exit 0;
email=$(abook --mutt-query "$selected_name" | awk '{if(NR>1) print $1}')

if [ $(echo -e "$email" | wc --words) -gt 1 ]; then
  email=$(echo "$email" | $rofi_cmd)
fi

[ -z "$email" ] && exit 0;

wl-copy "$email"

notify-send -t 2000 "Email address copied to clipboard"
