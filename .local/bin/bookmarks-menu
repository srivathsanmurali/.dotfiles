#!/bin/sh

set -e
BOOKMARKS_FILE=${BOOKMARKS_FILE:-$HOME/.config/bookmarks}

bookmark=$(
  cat "$BOOKMARKS_FILE" \
  | dmenu -i -l 15 -p "Bookmark" \
  | sed -E 's@\[.*\]\s*@@' \
  | sed -E 's@https?://@@'
)

[ -z "$bookmark" ] && exit 0

if $(grep "$bookmark" "$BOOKMARKS_FILE" > /dev/null 2>&1); then
  wl-copy "https://$bookmark"
  "$BROWSER" "https://$bookmark"
  notify-send -t 1000 "Bookmark Manager" "Bookmark copied to clipboard"
else
  tag=$(
    sed -E 's@\[(.*)\].*@\1@' "$BOOKMARKS_FILE" \
    | tr ',' '\n' \
    | sort -u \
    | dmenu -i -l 10 -p "Bookmark tag"
  )
  echo "[$tag] $bookmark" >> "$BOOKMARKS_FILE"
  notify-send -t 1000 "Bookmark Manager" "Bookmark added to bookmarks"
fi
